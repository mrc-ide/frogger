<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multistate Population Projection Model for Demographic and HIV Estimation • frogger</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Multistate Population Projection Model for Demographic and HIV Estimation">
<meta property="og:description" content="Leapfrog is a multistate population projection model for estimating population, demographic indicators, and HIV epidemic. The model combines a standard cohort component model of population projection (CCMPP) with a multistate model for HIV infection, disease progression, and treatment. Statistical tools are implemented for joint inference from multiple demographic and epidemiologic data sources.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">frogger</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/development.html">Developing leapfrog</a>
    </li>
    <li>
      <a href="articles/variables.html">Variable naming conventions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/frogger/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="frogger">frogger<a class="anchor" aria-label="anchor" href="#frogger"></a>
</h1></div>
<!-- badges: start -->

<p>Leapfrog is a multistate population projection model for demographic and HIV epidemic estimation.</p>
<p>The name <em>leapfrog</em> is in honor of <a href="https://iussp.org/en/basia-zaba-1949-2018" class="external-link">Professor</a> Basia <a href="https://translate.google.co.uk/?sl=pl&amp;tl=en&amp;text=Zaba&amp;op=translate" class="external-link">Zaba</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of frogger from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mrc-ide/frogger"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation-model">Simulation model<a class="anchor" aria-label="anchor" href="#simulation-model"></a>
</h2>
<p>The simulation model is implemented in a header-only C++ library located in <a href="inst/include/frogger.hpp"><code>inst/include/frogger.hpp</code></a>. This location allows the C++ code to be imported in other R packages via specifying <code>LinkingTo: leapfrog</code> in the <code>DESCRIPTION</code> file.</p>
<p>The simulation model is callable in R via a wrapper function <code><a href="reference/run_model.html">run_model()</a></code> created with <a href="https://www.rcpp.org" class="external-link">Rcpp</a>.</p>
<p>You can control how the simulation model is run with the following arguments:</p>
<ul>
<li>
<code>run_hiv_simulation</code> which is <code>TRUE</code> by default. Set to <code>FALSE</code> to turn off the HIV simulation and run only the demographic projection.</li>
<li>
<code>hiv_age_stratification</code> which must be “coarse” or “full”. Coarse is run with 5-year age groups and full with single year ages.</li>
<li>
<code>run_child_model</code> which is <code>FALSE</code> by default. Set to <code>TRUE</code> to run the child portion of the model.</li>
</ul>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>The file <code>pjnz/bwa_aim-adult-art-no-special-elig_v6.13_2022-04-18.PJNZ</code> contains an example Spectrum file constructed from default country data for Botswana with Spectrum (April 2022).</p>
<p>Prepare model inputs.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrc-ide/frogger" class="external-link">frogger</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">pjnz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"pjnz/bwa_aim-adult-art-no-special-elig_v6.13_2022-04-18.PJNZ"</span>,</span>
<span>                    package <span class="op">=</span> <span class="st">"frogger"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">demp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/prepare_leapfrog_demp.html">prepare_leapfrog_demp</a></span><span class="op">(</span><span class="va">pjnz</span><span class="op">)</span></span>
<span><span class="va">hivp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/prepare_leapfrog_projp.html">prepare_leapfrog_projp</a></span><span class="op">(</span><span class="va">pjnz</span><span class="op">)</span></span></code></pre></div>
<p>Simulate adult ‘full’ age group (single-year age) and ‘coarse’ age group (collapsed age groups) models from 1970 to 2030 with 10 HIV time steps per year.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lsimF</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_model.html">run_model</a></span><span class="op">(</span><span class="va">demp</span>, <span class="va">hivp</span>, <span class="fl">1970</span><span class="op">:</span><span class="fl">2030</span>, <span class="fl">10L</span>,</span>
<span>                   hiv_age_stratification <span class="op">=</span> <span class="st">"full"</span>, run_child_model <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">lsimC</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_model.html">run_model</a></span><span class="op">(</span><span class="va">demp</span>, <span class="va">hivp</span>, <span class="fl">1970</span><span class="op">:</span><span class="fl">2030</span>, <span class="fl">10L</span>,</span>
<span>                   hiv_age_stratification <span class="op">=</span> <span class="st">"coarse"</span>, run_child_model <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Compare the HIV prevalence age 15-49 years and AIDS deaths 50+ years. Deaths 50+ years are to show some noticeable divergence between the <code>"full"</code> and <code>"coarse"</code> age group simulations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prevF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">lsimF</span><span class="op">$</span><span class="va">p_hiv_pop</span><span class="op">[</span><span class="fl">16</span><span class="op">:</span><span class="fl">50</span>,,<span class="op">]</span>,,<span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">lsimF</span><span class="op">$</span><span class="va">p_total_pop</span><span class="op">[</span><span class="fl">16</span><span class="op">:</span><span class="fl">50</span>,,<span class="op">]</span>,,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">prevC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">lsimC</span><span class="op">$</span><span class="va">p_hiv_pop</span><span class="op">[</span><span class="fl">16</span><span class="op">:</span><span class="fl">50</span>,,<span class="op">]</span>,,<span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">lsimC</span><span class="op">$</span><span class="va">p_total_pop</span><span class="op">[</span><span class="fl">16</span><span class="op">:</span><span class="fl">50</span>,,<span class="op">]</span>,,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">deathsF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">lsimF</span><span class="op">$</span><span class="va">p_hiv_deaths</span><span class="op">[</span><span class="fl">51</span><span class="op">:</span><span class="fl">81</span>,,<span class="op">]</span>,,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">deathsC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">lsimC</span><span class="op">$</span><span class="va">p_hiv_deaths</span><span class="op">[</span><span class="fl">51</span><span class="op">:</span><span class="fl">81</span>,,<span class="op">]</span>,,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1970</span><span class="op">:</span><span class="fl">2030</span>, <span class="va">prevF</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"Prevalence 15-49"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1970</span><span class="op">:</span><span class="fl">2030</span>, <span class="va">prevC</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-sim_prev-1.png" width="100%"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1970</span><span class="op">:</span><span class="fl">2030</span>, <span class="va">deathsF</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"AIDS Deaths 50+ years"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1970</span><span class="op">:</span><span class="fl">2030</span>, <span class="va">deathsC</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-sim_prev-2.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="benchmarking">Benchmarking<a class="anchor" aria-label="anchor" href="#benchmarking"></a>
</h2>
<p>Install the package and then run the benchmarking script <code>./scripts/benchmark</code></p>
</div>
<div class="section level2">
<h2 id="lint">lint<a class="anchor" aria-label="anchor" href="#lint"></a>
</h2>
<p>Lint R code with <code>lintr</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lintr</span><span class="fu">::</span><span class="fu">lint_package</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Lint C++ code with <a href="https://github.com/cpplint/cpplint" class="external-link">cpplint</a></p>
<pre class="console"><code>cpplint inst/include/*</code></pre>
</div>
<div class="section level2">
<h2 id="code-design">Code design<a class="anchor" aria-label="anchor" href="#code-design"></a>
</h2>
<div class="section level3">
<h3 id="simulation-model-1">Simulation model<a class="anchor" aria-label="anchor" href="#simulation-model-1"></a>
</h3>
<p>The simulation model is implemented as templated C++ code in <code>inst/include/frogger.hpp</code>. This is so the simulation model may be developed as a standalone C++ library that can be called by other software without requiring R-specific code features. The code uses header-only open source libraries to maximize portability.</p>
</div>
<div class="section level3">
<h3 id="r-functions">R functions<a class="anchor" aria-label="anchor" href="#r-functions"></a>
</h3>
<p>The file <code>src/frogger.cpp</code> contains R wrapper functions for the model simulation via <a href="http://dirk.eddelbuettel.com/code/rcpp.html" class="external-link">Rcpp</a> and <a href="http://dirk.eddelbuettel.com/code/rcpp.eigen.html" class="external-link">RcppEigen</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="development-notes">Development notes<a class="anchor" aria-label="anchor" href="#development-notes"></a>
</h2>
<div class="section level3">
<h3 id="simulation-model-2">Simulation model<a class="anchor" aria-label="anchor" href="#simulation-model-2"></a>
</h3>
<ul>
<li>The model was implemented using <em>Eigen::Tensor</em> containers. These were preferred for several reasons:
<ul>
<li>Benchmarking found they were slighlty more efficient than <em>boost::multi_array</em>.</li>
<li>Column-major indexing in the same order as R</li>
<li>Other statistical packages (e.g. TMB, Stan) rely heavily on <em>Eigen</em> so using <em>Eigen</em> containers slims the dependencies.</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="todo">TODO<a class="anchor" aria-label="anchor" href="#todo"></a>
</h3>
<ul>
<li>Restructuring the model code to identify more common code
<ul>
<li>There are examples like general demographic projection and hiv population demographic projection which are running similar processes like ageing, non HIV mortality, migration. We should be able to write a function for e.g. ageing which we can run on each of our population matrices. Even for the HIV and ART stratified we can add overloaded function to work with higher dimension data</li>
</ul>
</li>
<li>Add a test that checks that no <code>double</code>s are used in <code>inst/include</code> dir. We should be using templated <code>real_type</code> for TMB</li>
<li>Add a broad level overview of the algorithm - is there a diagram available?</li>
<li>Convert string flags to the model to enums if we need to switch on them in several places. This should make it easier to reason about in C++ world and isolate the string checking to a single place</li>
<li>Previously <code>hiv_negative_pop</code> was fixed size by having dimensions specified by template, how much does this speed up the code? Is there a better way to do this?</li>
<li>Tidy up confusing looping see <a href="https://github.com/mrc-ide/frogger/pull/7#discussion_r1217847753" class="external-link uri">https://github.com/mrc-ide/frogger/pull/7#discussion_r1217847753</a>
</li>
<li>Add R casting helpers which return better errors than Rcpp see <a href="https://github.com/mrc-ide/frogger/pull/7#discussion_r1217884684" class="external-link uri">https://github.com/mrc-ide/frogger/pull/7#discussion_r1217884684</a>
</li>
<li>Add a helper to do 0 to base 1 conversion and check upper bounds see <a href="https://github.com/mrc-ide/frogger/pull/7#discussion_r1217888684" class="external-link uri">https://github.com/mrc-ide/frogger/pull/7#discussion_r1217888684</a>
</li>
<li>Review what we pass as parameters - can some of these be computed in the struct ctor? e.g. <a href="https://github.com/mrc-ide/frogger/pull/7#discussion_r1217890466" class="external-link uri">https://github.com/mrc-ide/frogger/pull/7#discussion_r1217890466</a>
</li>
<li>Refactor <code>OutputState</code> to take a struct of state-space dimensions instead of unpacking the subset of parameters we need. See <a href="https://github.com/mrc-ide/frogger/pull/12#discussion_r1245170775" class="external-link uri">https://github.com/mrc-ide/frogger/pull/12#discussion_r1245170775</a>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT © Imperial College of Science, Technology and Medicine</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/mrc-ide/frogger/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mrc-ide/frogger/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing frogger</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Jeffrey Imai-Eaton <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-7728-728X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Magdalene Walters <br><small class="roles"> Author </small>  </li>
<li>Robert Ashton <br><small class="roles"> Author, maintainer </small>  </li>
<li>Mantra Kusumgar <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#concept" class="external-link"><img src="https://www.repostatus.org/badges/latest/concept.svg" alt="Project Status: Concept – Minimal or no implementation has been done yet, or the repository is only intended to be a limited example, demo, or proof-of-concept."></a></li>
<li><a href="https://github.com/mrc-ide/frogger/actions" class="external-link"><img src="https://github.com/mrc-ide/frogger/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/github/mrc-ide/frogger?branch=main" class="external-link"><img src="https://codecov.io/github/mrc-ide/frogger/coverage.svg?branch=main" alt="codecov.io"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Jeffrey Imai-Eaton, Magdalene Walters, Robert Ashton, Mantra Kusumgar.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
